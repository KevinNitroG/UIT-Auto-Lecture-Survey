// ==UserScript==
// @name            UIT - Auto Lecture Survey
// @author          Kevin Nitro
// @namespace       UIT-KevinNitro
// @description     T·ª± ƒë·ªông ƒë√°nh gi√° kh·∫£o s√°t gi·∫£ng vi√™n UIT. vui l√≤ng disable script khi kh√¥ng s·ª≠ d·ª•ng, tr√°nh conflict v·ªõi c√°c kh·∫£o s√°t / link kh√°c c·ªßa tr∆∞·ªùng
// @license         https://github.com/KevinNitroG/UIT-Auto-Lecturer-Survey/raw/main/LICENSE
// @version         1.11
// @icon            https://github.com/KevinNitroG/UIT-Auto-Lecturer-Survey/raw/main/UIT-logo.png
// @match           http*://student.uit.edu.vn/sinhvien/phieukhaosat
// @match           http*://survey.uit.edu.vn/index.php/survey/index
// @match           http*://survey.uit.edu.vn/index.php/survey/index/sid/*/token/*
// @run-at          document-idle
// @grant           window.close
// @grant           GM_setValue
// @grant           GM_getValue
// @grant           GM.setValue
// @grant           GM.getValue
// @downloadURL     https://github.com/KevinNitroG/UIT-Auto-Lecturer-Survey/raw/main/UITAutoLecturerSurvey.user.js
// @updateURL       https://github.com/KevinNitroG/UIT-Auto-Lecturer-Survey/raw/main/UITAutoLecturerSurvey.user.js
// @supportURL      mailto:kevinnitro@duck.com
// ==/UserScript==

// THIS SCRIPT WAS GENERATED BY CHATGPT & My brain for 10% .-.

// ---------- START GLOBAL VARIABLES ----------

// Value for first type questions
const firstTypeSelectionsArray = [
  '>80%',
  '50-80%',
  'T·ª´ 70 ƒë·∫øn d∆∞·ªõi 90%',
  'Tr√™n 90%',
];

// Value for second type questions
const secondTypeSelectionsArray = [
  // 'answer_cell_00MH01',
  // 'answer_cell_00MH02',
  'answer_cell_00MH03',
  'answer_cell_00MH04',
];

const timeToSleep = 0;

// ---------- END GLOBAL VARIABLES ----------

// ---------- START HOMEPAGE FUNCTION ----------

// Return position
function UITAutoLecturerSurveyHomePagePosition() {
  return document
    .getElementsByClassName('content')[0]
    .getElementsByTagName('center')[0];
}

// Add paragrah
function UITAutoLecturerSurveyParagraph(headElement) {
  const para = document.createElement('p');
  const node = document.createTextNode(
    '‚≠ê B·∫°n ƒëang s·ª≠ d·ª•ng UIT - Auto Lecturer Survey b·ªüi Kevin Nitro üíñ'
  );
  para.appendChild(node);
  headElement.appendChild(para);
}

// Add auto survey button
function UITAutoLecturerSurveyAddAutoSurveyButton(headElement) {
  const executeButton = document.createElement('button');
  executeButton.textContent = 'Auto Survey';
  executeButton.addEventListener('click', UITAutoLecturerSurveyExecuteURLs);
  headElement.appendChild(executeButton);
}

// UN-IMPLEMENT FUNCTION - Auto survey
function UITAutoLecturerSurveyGetURL() {
  let links = Object.values(
    document.getElementsByTagName('table')[0].getElementsByTagName('a')
  );
  let data = [];
  links.forEach((link) => {
    if (link.innerHTML.includes(' - ')) {
      data += link;
    }
  });
  return data;
}

function UITAutoLecturerSurveyExecuteEachURL() {}

function UITAutoLecturerSurveyExecuteURLs() {}

// ---------- END HOMEPAGE FUNCTIONS ----------

// ---------- START EXECUTE FUNCTION ----------

function UITAutoLecturerSurveyRunScript() {
  // Sort array randomly and return array
  function sortArrayRandomly(array) {
    return array.sort(function () {
      return Math.random() - 0.5;
    });
  }

  // Return random index of array
  function randomIndex(array) {
    return Math.floor(Math.random() * array.length);
  }

  // Select first type questions
  let answerLabels = document.querySelectorAll('label.answertext');
  answerLabels.forEach(function (label) {
    let firstTypeSelectionsArrayRandom = sortArrayRandomly(
      firstTypeSelectionsArray
    );
    for (let i = 0; i < firstTypeSelectionsArrayRandom.length; i++) {
      if (label.innerText.trim() === firstTypeSelectionsArrayRandom[i]) {
        label.click();
        break;
      }
    }
  });

  // Select second type questions
  let secondTypeSelectionsArrayClass = secondTypeSelectionsArray.map(
    (className) => `${className} answer-item radio-item`
  );
  const radioLists = document.querySelectorAll('.answers-list.radio-list');
  radioLists.forEach(function (radioList) {
    let randomElementClass =
      secondTypeSelectionsArrayClass[
        randomIndex(secondTypeSelectionsArrayClass)
      ];
    let randomElement = radioList.querySelector(
      '.' + randomElementClass.replace(/ /g, '.')
    );
    if (randomElement) {
      randomElement.click();
    }
  });

  // Sleep before continue to next page / submit form
  setTimeout(function () {}, timeToSleep);

  // Continue to next page
  const moveNextBtn = document.querySelector(
    'button[type="submit"][id="movenextbtn"]'
  );
  if (moveNextBtn) {
    moveNextBtn.click();
  }

  // Submit form
  const submitBtn = document.getElementById('movesubmitbtn');
  if (submitBtn) {
    submitBtn.click();
  }

  // Close tab when done
  const doneWindow = document.querySelector('.site-name');
  if (doneWindow.innerText.trim() === 'HO√ÄN TH√ÄNH KH·∫¢O S√ÅT') {
    window.close();
  }
}

// ---------- END EXECUTE FUNCTION ----------

// ---------- START MAIN FUNCTION ----------

(function () {
  'use strict';
  if (window.location.pathname === '/sinhvien/phieukhaosat') {
    const headElement = UITAutoLecturerSurveyHomePagePosition();
    UITAutoLecturerSurveyParagraph(headElement);
    // const links = UITAutoLecturerSurveyGetURL();
    // if (links) {
    // UITAutoLecturerSurveyAddAutoSurveyButton(headElement);
    // }
  } else {
    UITAutoLecturerSurveyRunScript();
  }
  console.log(firstTypeSelectionsArray);
})();

// ---------- END MAIN FUNCTION ----------
